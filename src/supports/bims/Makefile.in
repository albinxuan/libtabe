#
# Copyright 1999, TaBE Project, All Rights Reserved.
# Copyright 1999, Pai-Hsiang Hsiao, All Rights Reserved.
#
# $Id: Makefile.in,v 1.1 2000/12/09 09:14:16 thhsieh Exp $
#
CC              = @CC@
CFLAGS          = @CFLAGS@
CPPFLAGS        = @CPPFLAGS@
DEFS            = @DEFS@
RANLIB          = @RANLIB@
LN_S            = @LN_S@
LDFLAGS         = @db_library@
INC             = -I@x_includes@ @db_include@ -I../..
INSTALL         = @INSTALL@
INSTALL_PROGRAM = @INSTALL_PROGRAM@
INSTALL_DATA    = @INSTALL_DATA@
sharelib_flags  = @sharelib_flags@
@SET_MAKE@

program_prefix = @program_prefix@
srcdir      = @srcdir@
top_srcdir  = @top_srcdir@
prefix      = $(program_prefix)@prefix@
exec_prefix = @exec_prefix@
libdir      = @libdir@
bindir      = @bindir@
includedir  = @includedir@
cf_sharelib = @cf_sharelib@
ld_sharelib = @ld_sharelib@
slib_ext    = @slib_ext@

version     = 0.2.0
major_ver   = 0.2

AR          = ar cr
RM          = rm -rf

LIBNAME     = bims
INCLUDES    = bims.h
SRC         = bims.c
LIBOBJS     = bims.o
SHARED_OBJS = obj-s/bims.o
unsharelib  = lib$(LIBNAME).a
sharelib    = lib$(LIBNAME).$(slib_ext)
so_ver      = $(sharelib).$(major_ver)


all: @make_all@

shared: $(sharelib).$(version)

unshared: $(unsharelib)

$(unsharelib): $(LIBOBJS)
	$(AR) $(unsharelib) $(LIBOBJS)
	if [ -n "$(RANLIB)" ]; then $(RANLIB) $(unsharelib); fi

$(sharelib).$(version): OBJSDIR $(SHARED_OBJS)
	$(ld_sharelib) -o $(sharelib).$(version) $(SHARED_OBJS)
	$(RM) $(sharelib) $(sharelib).$(major_ver)
	$(LN_S) $(sharelib).$(version) $(sharelib).$(major_ver)
	$(LN_S) $(sharelib).$(version) $(sharelib)

bims.o: bims.c bims.h
	$(CC) $(CFLAGS) $(DEFS) $(INC) -c -o $@ $<

obj-s/bims.o: bims.c bims.h
	$(CC) -c $(cf_sharelib) $(CFLAGS) $(DEFS) $(INC) -o $@ bims.c

OBJSDIR:
	if [ ! -d obj-s ]; then mkdir obj-s; fi

.PHONY: clean distclean install
clean:
	$(RM) $(LIBOBJS) $(SHARED_OBJS) $(unsharelib) $(sharelib)* core
distclean: clean
	if [ -d obj-s ]; then rmdir obj-s; fi
	$(RM) Makefile 

install: all
	if [ ! -d $(libdir) ]; then $(INSTALL) -d $(libdir); fi
	$(INSTALL_DATA) $(unsharelib) $(libdir)
	if [ -f $(sharelib) ]; then \
	    $(RM) $(libdir)/$(sharelib)*; \
	    $(INSTALL_PROGRAM) $(sharelib).$(version) $(libdir); \
	    (cd $(libdir); \
	     $(LN_S) $(sharelib).$(version) $(sharelib).$(major_ver); \
	     $(LN_S) $(sharelib).$(version) $(sharelib)); \
	fi

	if [ ! -d $(includedir) ]; then $(INSTALL) -d $(includedir); fi
	$(INSTALL_DATA) $(INCLUDES) $(includedir)
